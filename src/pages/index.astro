---
import App from '../app/App';
import '@/styles/index.css';
import { projects } from '@/data/portfolio';
import { fetchOgp, type OgpData } from '@/lib/ogp';

const urlSet = new Set<string>();

projects.forEach((group) => {
  group.items.forEach((item) => {
    if (item.playLink) {
      urlSet.add(item.playLink.url);
    }
    item.relatedLinks?.forEach((link) => urlSet.add(link.url));
  });
});

const ogpEntries = await Promise.all(
  Array.from(urlSet).map(async (url) => [url, await fetchOgp(url)] as const),
);

const ogpData = Object.fromEntries(
  ogpEntries.filter(([, data]) => data !== null),
) as Record<string, OgpData>;
---

<html lang="ja">
	<head>
		<meta charset="utf-8" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="viewport" content="width=device-width" />
		<meta name="generator" content={Astro.generator} />
		<title>Personal Portfolio Website</title>
	</head>
	<body>
		<App client:load ogpData={ogpData} />
	</body>
</html>
